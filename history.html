<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOLT999 - Game History</title>
    <meta name="theme-color" content="#111827">
    <meta name="description" content="Beast Earn - Play Color Prediction and Mine games to win real money!">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.avif">
    <link rel="icon" href="logo.avif" type="image/avif">

    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="firebase-config.js"></script>

    <style>
        body {
            font-family: sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #000000;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Logo Component
        const Logo = ({ onClick }) => (
            <div 
                className="w-16 h-16 rounded-full overflow-hidden border-4 border-yellow-400 shadow-lg cursor-pointer hover:scale-105 transition-transform"
                onClick={onClick}
            >
                <img src="logo.avif" alt="Beast Earn Logo" className="w-full h-full object-cover" />
            </div>
        );

        // History Component
        const History = () => {
            const [gameHistory, setGameHistory] = React.useState([]);
            const [userBalance, setUserBalance] = React.useState(0);
            const [isLoading, setIsLoading] = React.useState(true);
            const [selectedGame, setSelectedGame] = React.useState('all');

            React.useEffect(() => {
                // Check authentication
                const unsubscribe = firebase.auth().onAuthStateChanged((user) => {
                    if (!user) {
                        window.location.href = 'auth.html';
                    } else {
                        // Load user balance and history
                        loadUserBalance(user.uid);
                        loadGameHistory(user.uid);
                    }
                });

                return () => unsubscribe();
            }, []);

            const loadUserBalance = async (userId) => {
                try {
                    const userDoc = await firebase.firestore().collection('users').doc(userId).get();
                    if (userDoc.exists) {
                        setUserBalance(userDoc.data().balance || 0);
                    }
                } catch (error) {
                    console.error('Error loading balance:', error);
                }
            };

            const loadGameHistory = async (userId) => {
                try {
                    const historyRef = firebase.firestore().collection('game_history')
                        .where('userId', '==', userId)
                        .orderBy('timestamp', 'desc')
                        .limit(50);

                    const snapshot = await historyRef.get();
                    const history = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    setGameHistory(history);
                } catch (error) {
                    console.error('Error loading game history:', error);
                } finally {
                    setIsLoading(false);
                }
            };

            const formatTimestamp = (timestamp) => {
                if (!timestamp) return '';
                const date = timestamp.toDate();
                return date.toLocaleString();
            };

            const getGameIcon = (gameType) => {
                switch (gameType) {
                    case 'color':
                        return '🎨';
                    case 'mines':
                        return '💣';
                    case 'aviator':
                        return '✈️';
                    default:
                        return '🎮';
                }
            };

            const filteredHistory = gameHistory.filter(game => 
                selectedGame === 'all' || game.gameType === selectedGame
            );

            return (
                <div className="min-h-screen bg-gray-900 text-white p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-8">
                            <Logo onClick={() => window.location.href = 'index.html'} />
                            <div className="text-right">
                                <p className="text-yellow-400 font-bold">Balance: ₹{userBalance}</p>
                            </div>
                        </div>

                        <div className="bg-gray-800 p-6 rounded-xl">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold text-yellow-400">Game History</h2>
                                <select
                                    value={selectedGame}
                                    onChange={(e) => setSelectedGame(e.target.value)}
                                    className="px-4 py-2 bg-gray-700 rounded-lg text-white"
                                >
                                    <option value="all">All Games</option>
                                    <option value="color">Color Prediction</option>
                                    <option value="mines">Mines</option>
                                    <option value="aviator">Aviator</option>
                                </select>
                            </div>

                            {isLoading ? (
                                <div className="text-center py-8">
                                    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-400 mx-auto"></div>
                                    <p className="mt-4 text-gray-400">Loading history...</p>
                                </div>
                            ) : filteredHistory.length === 0 ? (
                                <div className="text-center py-8">
                                    <p className="text-gray-400">No game history found</p>
                                </div>
                            ) : (
                                <div className="space-y-4">
                                    {filteredHistory.map((game) => (
                                        <div
                                            key={game.id}
                                            className="bg-gray-700 p-4 rounded-lg flex items-center justify-between"
                                        >
                                            <div className="flex items-center space-x-4">
                                                <span className="text-2xl">{getGameIcon(game.gameType)}</span>
                                                <div>
                                                    <p className="font-semibold">
                                                        {game.gameType.charAt(0).toUpperCase() + game.gameType.slice(1)}
                                                    </p>
                                                    <p className="text-sm text-gray-400">
                                                        {formatTimestamp(game.timestamp)}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className={`font-bold ${
                                                    game.result > 0 ? 'text-green-400' : 'text-red-400'
                                                }`}>
                                                    {game.result > 0 ? '+' : ''}₹{game.result}
                                                </p>
                                                <p className="text-sm text-gray-400">
                                                    Bet: ₹{game.betAmount}
                                                </p>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Render the History component
        ReactDOM.render(<History />, document.getElementById('root'));
    </script>
</body>
</html> 